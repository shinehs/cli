$(document).ready(function($){function t(t,e,n,a){var i={act:"webevent",eventid:t,value:1,eventype:1,class1:"ent",class2:"shenqusite",bak1:"zbjc",bak2:n,bak3:e,parm3:""};a&&(i.uid=a),window.appHiido&&window.appHiido.stat(i)}function e(t,e,n){$.ajax({url:t,type:"get",dataType:"json",cache:!1}).done(function(t){e(t)}).fail(function(t){})}function n(t,e){var n=t.split("?"),a="";if(n[0]==t)return a;var i=n[1];n=i.split("&");for(var o=0;o<n.length;o++){i=n[o];var s=i.split("=");s.length<=1||s[0]==e&&(a=s[1])}return a}function a(t,e,n){t.jPlayer({ready:function(){$(this).jPlayer("setMedia",{m4v:e,poster:n}),$(this).jPlayer("play"),$.danmaku&&$.danmaku.go(!0),$(".errorTip").hide()},click:function(t){var e=["8.0","7.0","6.0"];$.browser.msie&&-1!=e.indexOf($.browser.version)&&(1==t.jPlayer.status.paused?$(this).jPlayer("play"):$(this).jPlayer("pause"))},play:function(t){$.danmaku&&$.danmaku._state&&$.danmaku.go()},pause:function(t){$.danmaku&&$.danmaku.stop()},ended:function(t){$.danmaku&&$.danmaku.stop(),$(".playcontent").hide("5000")},resize:function(t){$.danmaku&&$.danmaku._state?($.danmaku.stop(),$.danmaku.toggleActiveClass(),$.danmaku.go()):$.danmaku&&$.danmaku.toggleActiveClass()},swfPath:"http://s1.yy.com/shenqu/common/site/",supplied:"m4v",size:{width:k+"px",height:j+"px",cssClass:"jp-video-360p"},useStateClassSkin:!0,autoBlur:!1,smoothPlayBar:!0,keyEnabled:!0,dbcfullscreen:!1})}function i(){$(".footer").delegate(".prev,.next","click.shenqu",function(t){switch($(t.currentTarget).attr("class").split(" ")[0]){case"prev":if(1==T)return;T--;var e=o(p);0!=e.length?($(".songlist").html(e.join(" ")),$(".songlist").html(e.join(" "))):T++;break;case"next":T++;var e=o(p);0!=e.length?($(".songlist").html(e.join(" ")),$(".songlist").html(e.join(" "))):T--}var n=p.length%U==0?p.length/U:Math.floor(p.length/U)+1;1==T?($(".prev").removeClass("active"),p.length>U&&$(".next").addClass("active")):T>=n?($(".next,.prev").addClass("active"),$(".next").removeClass("active").removeClass("active")):$(".next,.prev").addClass("active").addClass("active")}),p.length>U&&$(".next").addClass("active")}function o(t){if($.isEmptyObject(t))return[];if(T>Math.floor(t.length/U+1))return[];for(var e=[],n=(T-1)*U,a=T*U>t.length?t.length:T*U;n<a;n++){var i=t[n];e.push('<li class="'+(i.songtype?i.songtype:"")+'" data-shorico="'+(i.snapshotURL?i.snapshotURL:"")+'" data-short="'+(i.shortVideoURL?i.shortVideoURL:"")+'" name="'+(i.worksUrl?i.worksUrl:i.longVideoURL)+'" title="'+(i.worksName?i.worksName:i.title)+'" desc="'+(i.description?i.description:"")+'" vid="'+(i.id?i.id:"")+'" aid="'+m+'"><a href="javascript:void(0);"><img src="'+(i.snapshot?i.snapshot:i.snapshotURL)+'" ><i class="text"></i><p>'+(i.worksName?i.worksName:i.title)+"</p></a></li>")}return e}function s(){$(".songlist").delegate("li","click",function(e){window.external.sendCommand("openvideownd","http://shenqu.yy.com/ext/zbj/onlyplayer.html?url="+$(this).attr("name")+"&vid="+$(this).attr("vid")+"&aid="+$(this).attr("aid")+"&from=zbjc","640","514"),t(L,M,$(this).attr("vid"))})}function r(){if(m==A)return void $(".focus-btn").remove();e(z+m,function(t){t.data&&t.data.isSub?($(".focus-btn").remove(),$(".header").html("TA的最新神曲")):$(".focus-btn").one("click.zbj",function(t){e(P,function(t){t.data&&t.data.result?($(".focus-btn").addClass("success"),$(".focus-btn").html("已关注"),$(".header").html("TA的最新神曲"),$(".focus-btn").remove(),window.external.sendCommand("livenotifycallback",m)):($(".focus-btn").addClass("error"),$(".focus-btn").html("失败"),setTimeout(function(t){$(".focus-btn").html("关注TA"),$(".focus-btn").removeClass("error"),r()},5e3))},function(t){$(".focus-btn").addClass("error"),$(".focus-btn").html("失败"),setTimeout(function(t){$(".focus-btn").html("关注TA"),$(".focus-btn").removeClass("error"),r()},5e3)})})})}function d(t){$(".jp-index").bind("mouseenter",function(){$(".tips").addClass("active")}),$(".jp-index").bind("mouseleave",function(){$(".tips").removeClass("active")}),t?$(".jp-index").attr("href","http://shenqu.yy.com/play/id_"+t+".html"):($(".jp-index").attr("href","javascript:void(0)"),$(".jp-index").removeAttr("href"))}function l(){$(".songlist").delegate("li","mouseenter",function(t){$("img",t.currentTarget).stop(!0,!1).animate({width:g,height:v},150,"linear"),$("a",t.currentTarget).stop(!0,!1).animate({top:b,left:y},150,"linear")}),$(".songlist").delegate("li","mouseleave",function(t){$("img",t.currentTarget).animate({width:C,height:w},150,"linear"),$("a",t.currentTarget).stop(!0,!1).animate({top:0,left:0},150,"linear")})}function c(){$(".upLoad").bind("click.shenqu",function(){m&&0!=m&&window.external.sendCommand("musicOpenUrl_nologin","http://m.yy.com/ents/u/"+m+"#gm")})}function u(){s(),h(),r(),(window.ActiveXObject||"ActiveXObject"in window)&&l(),i(),c()}function h(){$(".closebtn").bind("click.zbj",function(t){$("#jquery_jplayer_1").jPlayer("pause"),$(".playcontent").hide("5000")})}function f(){var e=$(".songlist").find(".fanrenge:first");0!=e.length&&(a($("#jquery_jplayer_1"),e.attr("data-short"),e.attr("data-shorico")),$("#jp_container_1").delegate("#jquery_jplayer_1","dblclick",function(){return!1}),$(".playcontent").show("5000"),d(e.attr("vid")),t(O,R,e.attr("vid"),A))}var p,m,v,g,b,y,j,k,w,C,x="/shenqu/zbj/getAnchorId.do?cid=",q="/shenqu/zbj/listZbjCenter.do?aid=",T=1,_=n(window.location.href,"cid"),A=n(window.location.href,"uid"),z="http://shenqu.yy.com/zbj/isSubscribed.do?uid="+A+"&aid=",P="http://shenqu.yy.com/zbj/subscriedLiving.do?uid="+A+"&cid="+_+"&isSub=false",U=function(){var t=n(window.location.href,"videoW"),e=6;switch(v=124,g=164,w=108,C=143,b=-8,y=-11,j=360,k=480,t){case"640":$(".header,.focus-btn,.maincontent").addClass("v_480"),j=480,k=640,e=12;break;case"400":$(".header,.focus-btn,.maincontent").addClass("v_400"),j=300,k=400,e=4;break;case"320":$(".maincontent,.go-index").addClass("v_320"),j=240,k=320,e=2;break;default:e=6}return e}(),L=10006059,O=10005121,R="play",M="listclick";t(L,"visit"),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length>>>0,n=Number(arguments[1])||0;for(n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=e);n<e;n++)if(n in this&&this[n]===t)return n;return-1}),function(){e(x+_,function(t){if(!t.code){if(void 0===(m=t.data.aid))return $("#errorTip p").html("加载失败，请稍后再试！"),flase;e(q+m+"&sortRule=2",function(t){if(!t.code){var e=t.data;e.fanrenge&&0!=e.fanrenge.length&&(e.fanrenge[0].songtype="fanrenge",e.shenqu.splice(0,0,e.fanrenge[0])),p=t.data.shenqu?t.data.shenqu:[];var n=o(e.shenqu);$(".songlist").html(n.join(" ")),$(".songlist").html(n.join(" ")),0==n.length&&(m==A?$(".sid-acthor").show():$(".sid-user").show()),u(),$("#errorTip").hide(),f()}},function(t){$("#errorTip p").html("服务器掉地上了，请稍后再试！"),$("#errorTip").hide()})}}),$(".body-content").addClass("active")}()});